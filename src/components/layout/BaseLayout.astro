---
/**
 * BaseLayout.astro
 * Layout global: SEO (canonical + hreflang) + Header/Footer + contenedor + slot principal.
 */

import Header from "./Header.astro";
import Footer from "./Footer.astro";

type Props = {
  title: string;
  description?: string;
  canonical?: string; // opcional: override completo o relativo
  ogImage?: string;   // opcional: ruta absoluta o relativa
  noindex?: boolean;
  alternates?: {
  en: string;
  es: string;
  xDefault?: string;
};


  // i18n (opcional): si no se pasa, se infiere desde la ruta (/es/...)
  locale?: "en" | "es";
};

const {
  title,
  description = "Professional portfolio website.",
  canonical,
  ogImage,
  noindex = false,
  locale: localeProp,
} = Astro.props as Props;

// URL base del sitio (usa Astro.site si está configurado en astro.config.mjs)
const siteUrl = Astro.site ? new URL(Astro.site) : new URL("http://localhost:4321");

// Locale: prop > inferido por pathname
const pathname = Astro.url.pathname; // ej: /es/projects/ o /projects/
const locale: "en" | "es" = localeProp ?? (pathname.startsWith("/es/") || pathname === "/es" ? "es" : "en");

// Path sin prefijo de idioma (para alternates)
const cleanPath = pathname.replace(/^\/es(?=\/|$)/, ""); // "/projects/" o "/"

// URLs alternas por idioma (asumiendo simetría de rutas EN/ES)
const alternates = (Astro.props as Props).alternates;

const enUrl = alternates?.en ?? new URL(cleanPath || "/", siteUrl).toString();
const esUrl = alternates?.es ?? new URL(`/es${cleanPath || "/"}`, siteUrl).toString();
const xDefaultUrl = alternates?.xDefault ?? enUrl;


// Canonical final:
// - si te lo pasan, se respeta
// - si no, se usa el canonical del idioma actual
const canonicalUrl = canonical
  ? new URL(canonical, siteUrl).toString()
  : (locale === "es" ? esUrl : enUrl);

// OG image final: opcional (ideal: /images/og/default.jpg)
const ogImageUrl = new URL(ogImage ?? "/images/og/default.jpg", siteUrl).toString();
---

<!doctype html>
<html lang={locale}>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>{title}</title>
    <meta name="description" content={description} />
    <link rel="canonical" href={canonicalUrl} />

    {noindex ? <meta name="robots" content="noindex, nofollow" /> : null}

    <!-- i18n: hreflang alternates -->
    <link rel="alternate" hreflang="en" href={enUrl} />
    <link rel="alternate" hreflang="es" href={esUrl} />
    <link rel="alternate" hreflang="x-default" href={xDefaultUrl} />


    <!-- OpenGraph -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:url" content={canonicalUrl} />
    {ogImageUrl ? <meta property="og:image" content={ogImageUrl} /> : null}

    <!-- Twitter -->
    <meta name="twitter:card" content={ogImageUrl ? "summary_large_image" : "summary"} />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    {ogImageUrl ? <meta name="twitter:image" content={ogImageUrl} /> : null}

    <!-- (Opcional) Favicon: asegúrate de tenerlo en /public -->
    <link rel="icon" href="/favicon.svg" />

    <!-- Global styles -->
    <style>
    :root {
        color-scheme: dark;

    /* Developer dark theme tokens */
      --bg: #0d1117;
      --surface: #161b22;
      --border: #30363d;

      --text: #e6edf3;
      --muted: #9da7b3;

      --link: #58a6ff;
    }

    ::selection {
      background: rgba(88,166,255,0.25);
    }

    @media (prefers-reduced-motion: reduce) {
      * {
        transition: none !important;
      }
    }


      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        line-height: 1.5;
        background: var(--bg);
        color: var(--text);
      }

      a {
        color: var(--link);
        text-decoration: none;
      }

      a:hover {
        text-decoration: underline;
      }


      .page {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      main {
        flex: 1;
      }

      .content {
        max-width: 1100px;
        margin: 0 auto;
        padding: 34px 18px 46px;
      }
      /* Surfaces (cards) */
      .card {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 14px;
        padding: 16px;
        color: var(--text);
        transition: transform 0.2s ease, border-color 0.2s ease;
        box-shadow: 0 1px 0 rgba(255,255,255,0.03);
      }
      .card:hover {
        transform: translateY(-2px);
        border-color: rgba(88,166,255,0.55);
        background: rgba(22,27,34,0.9);
      }

      .card-title {
        margin: 0;
        font-size: 16px;
        line-height: 1.3;
        letter-spacing: -0.01em;
        color: var(--text);
      }

      .card-link {
        color: var(--link);
      }

      .card-link:hover {
        text-decoration: underline;
      }

      .badge {
        font-size: 12px;
        padding: 4px 8px;
        border-radius: 999px;
        border: 1px solid var(--border);
        color: var(--muted);
        background: transparent;
      }
      .chips {
        list-style: none;
        padding: 0;
        margin: 10px 0 0;
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
      }

      .chip {
        font-size: 11px;
        padding: 4px 8px;
        border-radius: 999px;
        border: 1px solid var(--border);
        color: var(--muted);
        background: rgba(255,255,255,0.02);
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 16px;
      }


      /* Typography helpers */
      .muted {
        color: var(--muted);
      }

    </style>
  </head>

  <body>
    <div class="page">
      <Header locale={locale} />

      <main id="main-content">
        <div class="content">
          <slot />
        </div>
      </main>

      <Footer />
    </div>
  </body>
</html>
