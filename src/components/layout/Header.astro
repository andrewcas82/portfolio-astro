---
import navigation from "../../data/navigation";
import socials from "../../data/socials";
import { UI, getLocaleFromAstro } from "../../i18n/ui";

const locale = getLocaleFromAstro(Astro.currentLocale) as "en" | "es";
const base = locale === "es" ? "/es" : "";

/** Siempre devuelve rutas absolutas con trailing slash (excepto raíz) */
const abs = (path: string) => {
  // normaliza path entrante
  let p = path?.trim() || "/";
  if (!p.startsWith("/")) p = `/${p}`;
  if (p !== "/" && p.endsWith("/")) p = p.slice(0, -1); // quita slash final para controlar uno solo

  // compone con base (evita doble /es/es)
  const full = p === "/" ? `${base}/` : `${base}${p}/`;
  return full === "//" ? "/" : full;
};

/** Quita /es del pathname actual para “switch” consistente */
const stripEs = (p: string) => {
  if (p === "/es" || p === "/es/") return "/";
  return p.startsWith("/es/") ? `/${p.slice(4)}` : p;
};

const navLocalized = navigation.map((item) => ({
  href: abs(item.href),
  label: UI[locale].nav[item.key],
}));

const homeHref = abs("/");

const switchTo: "en" | "es" = locale === "es" ? "en" : "es";
const basePath = stripEs(Astro.url.pathname);

// si estás en ES, al cambiar a EN quita /es; si estás en EN, al cambiar a ES agrega /es
const switchHref =
  switchTo === "es"
    ? (basePath === "/" ? "/es/" : `/es${basePath.endsWith("/") ? basePath : `${basePath}/`}`)
    : (basePath === "/" ? "/" : (basePath.endsWith("/") ? basePath : `${basePath}/`));

const norm = (s: string) => (s !== "/" && s.endsWith("/") ? s.slice(0, -1) : s);
const isActive = (href: string) => norm(Astro.url.pathname) === norm(href);
---

<header class="site-header" role="banner">
  <div class="container">
    <a class="brand" href={homeHref} aria-label="Go to home">
      <span class="brand-name">Andrés Castrillón</span>
      <span class="brand-subtitle">Software Engineer · XR Developer · Aviation Maintenance Engineer</span>
    </a>

    <nav class="nav" aria-label="Primary navigation">
      <ul class="nav-list" role="list">
        {navLocalized.map((item) => (
          <li>
            <a class:list={["nav-link", isActive(item.href) && "active"]} href={item.href}>
              {item.label}
            </a>
          </li>
        ))}
        <li class="lang">
          <a class="nav-link" href={switchHref} aria-label="Switch language">
            {switchTo === "es" ? "ES" : "EN"}
          </a>
        </li>
      </ul>
    </nav>

    <div class="socials" aria-label="Social links">
      {socials?.length ? (
        <ul class="socials-list" role="list">
          {socials.map((s) => (
            <li>
              <a class="social-link" href={s.href} target="_blank" rel="noreferrer" aria-label={s.label} title={s.label}>
                {s.label}
              </a>
            </li>
          ))}
        </ul>
      ) : null}
    </div>
  </div>
</header>
<style>


/* tu CSS aquí */
  /* Layout */
  .site-header {
    position: sticky;
    top: 0;
    z-index: 50;
    background: white;
    border-bottom: 1px solid rgba(0, 0, 0, 0.08);
  }

  .container {
    max-width: 1100px;
    margin: 0 auto;
    padding: 14px 18px;
    display: grid;
    grid-template-columns: 1.2fr 1fr auto;
    gap: 16px;
    align-items: center;
  }

  /* Marca */
  .brand {
    display: inline-flex;
    flex-direction: column;
    text-decoration: none;
    color: inherit;
    min-width: 0;
  }

  .brand-name {
    font-size: 16px;
    font-weight: 700;
    line-height: 1.2;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .brand-subtitle {
    font-size: 12px;
    line-height: 1.2;
    opacity: 0.75;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    margin-top: 4px;
  }

  /* Nav */
  .nav-list {
    display: flex;
    gap: 14px;
    justify-content: center;
    align-items: center;
    padding: 0;
    margin: 0;
    list-style: none;
  }

  .nav-link {
    display: inline-flex;
    padding: 8px 10px;
    text-decoration: none;
    color: inherit;
    border-radius: 8px;
    font-size: 14px;
    opacity: 0.85;
  }

  .nav-link:hover {
    opacity: 1;
    background: rgba(0, 0, 0, 0.04);
  }

  .nav-link.active {
    opacity: 1;
    font-weight: 600;
    background: rgba(0, 0, 0, 0.06);
  }

  /* Socials */
  .socials-list {
    display: flex;
    gap: 10px;
    justify-content: flex-end;
    align-items: center;
    padding: 0;
    margin: 0;
    list-style: none;
  }

  .social-link {
    display: inline-flex;
    padding: 8px 10px;
    text-decoration: none;
    color: inherit;
    border-radius: 8px;
    font-size: 13px;
    opacity: 0.85;
  }

  .social-link:hover {
    opacity: 1;
    background: rgba(0, 0, 0, 0.04);
  }

  /* Responsive */
  @media (max-width: 860px) {
    .container {
      grid-template-columns: 1fr;
      gap: 10px;
    }

    .nav-list {
      justify-content: flex-start;
      flex-wrap: wrap;
    }

    .socials-list {
      justify-content: flex-start;
      flex-wrap: wrap;
    }
  }
</style>
